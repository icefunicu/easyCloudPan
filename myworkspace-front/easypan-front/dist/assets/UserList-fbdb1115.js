import{_ as K,a as E,r as d,e as o,f as k,h as w,i as _,j as e,w as a,k as V,p as H,n as b,t as S,A as D,m as N,v as G}from"./index-e609a1ae.js";const J={class:"top-panel"},P={class:"file-list"},Q={class:"avatar"},W={key:0,style:{color:"#529b2e"}},X={key:1,style:{color:"#f56c62"}},Y=["onClick"],Z=["onClick"],ee={__name:"UserList",setup(te){const{proxy:u}=E(),h={loadDataList:"/admin/loadUserList",updateUserStatus:"/admin/updateUserStatus",updateUserSpace:"/admin/updateUserSpace"},R=[{label:"头像",prop:"avatar",width:80,scopedSlots:"avatar"},{label:"昵称",prop:"nickName"},{label:"邮箱",prop:"email"},{label:"空间使用",prop:"space",scopedSlots:"space"},{label:"加入时间",prop:"joinTime"},{label:"最后登录时间",prop:"lastLoginTime"},{label:"状态",prop:"status",scopedSlots:"status",width:80},{label:"操作",prop:"op",width:150,scopedSlots:"op"}],r=d({}),m=d({}),z={extHeight:20},c=async()=>{let l={pageNo:m.value.pageNo,pageSize:m.value.pageSize};Object.assign(l,r.value);let t=await u.Request({url:h.loadDataList,params:l});t&&(m.value=t.data)},L=l=>{u.Confirm(`你确定要【${l.status==0?"启用":"禁用"}】吗?`,async()=>{await u.Request({url:h.updateUserStatus,params:{userId:l.userId,status:l.status==0?1:0}})&&c()})},i=d({show:!1,title:"修改空间大小",buttons:[{type:"primary",text:"确定",click:l=>{T()}}]}),p=d({}),f=d(),x={changeSpace:[{required:!0,message:"请输入空间大小"}]},I=l=>{i.value.show=!0,G(()=>{f.value.resetFields(),p.value=Object.assign({},l)})},T=()=>{f.value.validate(async l=>{if(!l)return;let t={};Object.assign(t,p.value),await u.Request({url:h.updateUserSpace,params:t})&&(i.value.show=!1,u.Message.success("操作成功"),c())})};return(l,t)=>{const g=o("el-input"),v=o("el-form-item"),y=o("el-col"),U=o("el-option"),q=o("el-select"),F=o("el-button"),j=o("el-row"),C=o("el-form"),M=o("Avatar"),A=o("el-divider"),B=o("Table"),O=o("Dialog");return k(),w("div",null,[_("div",J,[e(C,{model:r.value,rules:x,ref_key:"formDataRef",ref:f,"label-width":"80px",onSubmit:t[2]||(t[2]=V(()=>{},["prevent"]))},{default:a(()=>[e(j,null,{default:a(()=>[e(y,{span:4},{default:a(()=>[e(v,{label:"用户昵称"},{default:a(()=>[e(g,{clearable:"",placeholder:"支持模糊搜索",modelValue:r.value.nickNameFuzzy,"onUpdate:modelValue":t[0]||(t[0]=n=>r.value.nickNameFuzzy=n),modelModifiers:{trim:!0},onKeyup:H(c,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(y,{span:4},{default:a(()=>[e(v,{label:"状态"},{default:a(()=>[e(q,{clearable:"",placeholder:"请选择状态",modelValue:r.value.status,"onUpdate:modelValue":t[1]||(t[1]=n=>r.value.status=n)},{default:a(()=>[e(U,{value:1,label:"启用"}),e(U,{value:0,label:"禁用"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(y,{span:4,style:{"padding-left":"10px"}},{default:a(()=>[e(F,{type:"primary",onClick:c},{default:a(()=>[b("查询")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",P,[e(B,{ref:"dataTableRef",columns:R,dataSource:m.value,fetch:c,initFetch:!0,options:z,onRowSelected:l.rowSelected},{avatar:a(({index:n,row:s})=>[_("div",Q,[e(M,{userId:s.userId,avatar:s.qqAvatar},null,8,["userId","avatar"])])]),space:a(({index:n,row:s})=>[b(S(D(u).Utils.size2Str(s.useSpace))+" / "+S(D(u).Utils.size2Str(s.totalSpace)),1)]),status:a(({index:n,row:s})=>[s.status==1?(k(),w("span",W,"启用")):N("",!0),s.status==0?(k(),w("span",X,"禁用")):N("",!0)]),op:a(({index:n,row:s})=>[_("span",{class:"a-link",onClick:$=>I(s)},"分配空间",8,Y),e(A,{direction:"vertical"}),_("span",{class:"a-link",onClick:$=>L(s)},S(s.status==0?"启用":"禁用"),9,Z)]),_:1},8,["dataSource","onRowSelected"])]),e(O,{show:i.value.show,title:i.value.title,buttons:i.value.buttons,width:"400px",showCancel:!1,onClose:t[5]||(t[5]=n=>i.value.show=!1)},{default:a(()=>[e(C,{model:p.value,rules:x,ref_key:"formDataRef",ref:f,"label-width":"80px",onSubmit:t[4]||(t[4]=V(()=>{},["prevent"]))},{default:a(()=>[e(v,{label:"昵称"},{default:a(()=>[b(S(p.value.nickName),1)]),_:1}),e(v,{label:"空间大小",prop:"changeSpace"},{default:a(()=>[e(g,{clearable:"",placeholder:"请输入空间大小",modelValue:p.value.changeSpace,"onUpdate:modelValue":t[3]||(t[3]=n=>p.value.changeSpace=n),modelModifiers:{trim:!0}},{suffix:a(()=>[b("MB")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},le=K(ee,[["__scopeId","data-v-4e6a4321"]]);export{le as default};
