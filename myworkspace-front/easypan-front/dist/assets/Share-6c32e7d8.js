import{_ as se,a as ae,u as te,b as oe,r as i,e as r,G as ne,f as o,h as d,i as s,H as le,F as N,j as f,t as v,l as y,w as k,A as L,n as O,m,q as ce,s as ie}from"./index-e609a1ae.js";const w=S=>(ce("data-v-cbeeab31"),S=S(),ie(),S),re=w(()=>s("span",{class:"iconfont icon-pan"},null,-1)),de=w(()=>s("span",{class:"name"},"Easy云盘",-1)),ue=[re,de],he={class:"share-body"},pe={key:0,class:"loading"},_e={class:"share-panel"},fe={class:"share-user-info"},ve={class:"avatar"},ye={class:"share-info"},me={class:"user-info"},Se={class:"nick-name"},ge={class:"share-time"},Ie={class:"file-name"},ke={class:"share-op-btn"},we=w(()=>s("span",{class:"iconfont icon-cancel"},null,-1)),be=w(()=>s("span",{class:"iconfont icon-import"},null,-1)),Ce={class:"file-list"},Fe=["onMouseenter","onMouseleave"],Te=["title"],Ne=["onClick"],Re={class:"op"},xe=["onClick"],De=["onClick"],Me={key:0},Le={__name:"Share",setup(S){const{proxy:n}=ae(),h=te(),b=oe(),u={getShareLoginInfo:"/showShare/getShareLoginInfo",loadFileList:"/showShare/loadFileList",createDownloadUrl:"/showShare/createDownloadUrl",download:"/api/showShare/download",cancelShare:"/share/cancelShare",saveShare:"/showShare/saveShare"},c=b.params.shareId,l=i({});(async()=>{let e=await n.Request({url:u.getShareLoginInfo,showLoading:!1,params:{shareId:c}});if(e){if(e.data==null){h.push(`/shareCheck/${c}`);return}l.value=e.data}})();const U=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],p=i({}),z={extHeight:80,selectType:"checkbox"},C=async()=>{let e={pageNo:p.value.pageNo,pageSize:p.value.pageSize,shareId:c,filePid:R.value.fileId},t=await n.Request({url:u.loadFileList,params:e});t&&(p.value=t.data)},P=e=>{p.value.list.forEach(t=>{t.showOp=!1}),e.showOp=!0},q=e=>{e.showOp=!1},_=i([]),V=e=>{_.value=[],e.forEach(t=>{_.value.push(t.fileId)})},R=i({fileId:"0"}),$=e=>{const{curFolder:t}=e;R.value=t,C()},x=i(),D=i(),j=e=>{if(e.folderType==1){D.value.openFolder(e);return}e.shareId=c,x.value.showPreview(e,2)},A=async e=>{let t=await n.Request({url:u.createDownloadUrl+"/"+c+"/"+e.fileId});t&&(window.location.href=u.download+"/"+t.data)},g=i(),F=[],B=()=>{if(_.value.length!=0){if(!n.VueCookies.get("userInfo")){h.push("/login?redirectUrl="+b.path);return}F.value=_.value,g.value.showFolderDialog()}},E=e=>{if(!n.VueCookies.get("userInfo")){h.push("/login?redirectUrl="+b.path);return}F.value=[e.fileId],g.value.showFolderDialog()},H=async e=>{await n.Request({url:u.saveShare,params:{shareId:c,shareFileIds:F.value.join(","),myFolderId:e}})&&(C(),n.Message.success("保存成功"),g.value.close())},G=()=>{n.Confirm("你确定要取消分享吗?",async()=>{await n.Request({url:u.cancelShare,params:{shareIds:c}})&&(n.Message.success("取消分享成功"),h.push("/"))})},J=()=>{h.push("/")};return(e,t)=>{const K=r("Avatar"),M=r("el-button"),Q=r("Navigation"),T=r("Icon"),W=r("Table"),X=r("FolderSelect"),Y=r("Preview"),Z=ne("loading");return o(),d(N,null,[s("div",{class:"share"},[s("div",{class:"header"},[s("div",{class:"header-content"},[s("div",{class:"logo",onClick:J},ue)])])]),s("div",he,[Object.keys(l.value).length==0?le((o(),d("div",pe,null,512)),[[Z,Object.keys(l.value).length==0]]):(o(),d(N,{key:1},[s("div",_e,[s("div",fe,[s("div",ve,[f(K,{userId:l.value.userId,avatar:l.value.avatar,width:50},null,8,["userId","avatar"])]),s("div",ye,[s("div",me,[s("span",Se,v(l.value.nickName),1),s("span",ge,"分享于："+v(l.value.shareTime),1)]),s("div",Ie,"分享文件："+v(l.value.fileName),1)])]),s("div",ke,[l.value.currentUser?(o(),y(M,{key:0,type:"primary",onClick:G},{default:k(()=>[we,O(" 取消分享")]),_:1})):(o(),y(M,{key:1,type:"primary",onClick:B,disabled:_.value.length==0},{default:k(()=>[be,O(" 保存到我的网盘")]),_:1},8,["disabled"]))])]),f(Q,{ref_key:"navigationRef",ref:D,onNavChange:$,shareId:L(c)},null,8,["shareId"]),s("div",Ce,[f(W,{ref:"dataTableRef",columns:U,dataSource:p.value,fetch:C,initFetch:!1,options:z,onRowSelected:V},{fileName:k(({index:ee,row:a})=>[s("div",{class:"file-item",onMouseenter:I=>P(a),onMouseleave:I=>q(a)},[(a.fileType==3||a.fileType==1)&&a.status==2?(o(),y(T,{key:0,cover:a.fileCover,width:32},null,8,["cover"])):(o(),d(N,{key:1},[a.folderType==0?(o(),y(T,{key:0,fileType:a.fileType},null,8,["fileType"])):m("",!0),a.folderType==1?(o(),y(T,{key:1,fileType:0})):m("",!0)],64)),s("span",{class:"file-name",title:a.fileName},[s("span",{onClick:I=>j(a)},v(a.fileName),9,Ne)],8,Te),s("span",Re,[a.folderType==0?(o(),d("span",{key:0,class:"iconfont icon-download",onClick:I=>A(a)},"下载",8,xe)):m("",!0),a.showOp&&!l.value.currentUser?(o(),d("span",{key:1,class:"iconfont icon-import",onClick:I=>E(a)},"保存到我的网盘",8,De)):m("",!0)])],40,Fe)]),fileSize:k(({index:ee,row:a})=>[a.fileSize?(o(),d("span",Me,v(L(n).Utils.size2Str(a.fileSize)),1)):m("",!0)]),_:1},8,["dataSource"])])],64)),f(X,{ref_key:"folderSelectRef",ref:g,onFolderSelect:H},null,512),f(Y,{ref_key:"previewRef",ref:x},null,512)])],64)}}},ze=se(Le,[["__scopeId","data-v-cbeeab31"]]);export{ze as default};
