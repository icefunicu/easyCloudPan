# EasyCloudPan 项目亮点与技术难点

## 项目概览
- 项目名称：EasyCloudPan（前后端分离网盘系统）
- 技术栈：Java 21、Spring Boot 3.2、MyBatis-Flex、PostgreSQL、Redis、MinIO、Vue 3、Vite、Docker Compose、Prometheus/Grafana
- 项目定位：覆盖用户认证、文件上传下载、分享转存、回收站、文件预览、多租户、监控告警的一体化网盘系统

## 核心亮点（简历可用）
1. 设计并落地虚拟线程并发模型，打通 HTTP 请求处理、`@Async` 异步任务与对象存储 I/O，提升高并发场景下的线程利用率与系统吞吐能力。  
2. 构建完整文件上传链路：分片上传、秒传、断点续传、并发限流、空间配额校验、上传失败自动清理，覆盖大文件上传核心场景。  
3. 实现多级缓存架构（Caffeine L1 + Redis L2 + DB L3），并引入空值缓存、布隆过滤器、分布式锁与随机 TTL，系统性治理缓存穿透/击穿/雪崩问题。  
4. 推出游标分页机制替代深度 OFFSET 分页，在大数据量文件列表与分享列表场景中保持查询稳定性。  
5. 建立多租户能力：请求层租户识别（Header/域名）+ 上下文隔离 + 数据层租户过滤 + 租户配额校验，保障租户隔离与资源可控。  
6. 加固认证鉴权链路：JWT 双 Token + Refresh Token + 黑名单失效 + 参数校验 + 文件访问控制切面 + 会话固定防护。  
7. 打通可观测性：Actuator + Micrometer 指标、Web Vitals 上报与入库、Prometheus/Grafana 监控与告警规则，支持性能与稳定性持续观测。  
8. 完善质量保障体系：后端单测 + 属性测试（jqwik）覆盖并发与存储关键能力，前端接入 Playwright E2E。

## 技术难点与解决方案

### 1) 大文件上传稳定性与一致性
- 难点：高并发上传下容易出现分片乱序、并发过载、空间超配、失败后脏数据残留。  
- 方案：入口分片参数强校验；用户级并发限流；上传过程实时校验用户与租户空间；最后分片完成后再事务化落库；异常路径统一清理临时文件。  
- 收益：上传链路可恢复、可限流、可回滚，复杂网络环境下的可用性更高。

### 2) 缓存高并发场景下的稳定性
- 难点：热点数据易击穿，不存在数据易穿透，集中失效易雪崩。  
- 方案：多级缓存分层读取；空值缓存减少无效回源；布隆过滤器前置过滤；分布式锁控制回源并发；随机 TTL 分散失效时间。  
- 收益：显著降低数据库压力，提升热点数据读性能与系统稳定性。

### 3) 深分页性能衰减
- 难点：传统 OFFSET 在大页码下性能线性恶化。  
- 方案：以 `create_time + id` 作为复合游标，实现稳定有序翻页；返回 `nextCursor` 驱动前端继续加载。  
- 收益：大规模文件/分享列表在高页码下仍保持较稳定响应。

### 4) 多租户上下文隔离
- 难点：请求线程复用下易产生租户上下文污染，且配额控制分散。  
- 方案：拦截器统一提取租户并写入 ThreadLocal，请求结束强制清理；数据层统一租户注入；上传前执行租户配额检查与缓存增量更新。  
- 收益：租户隔离边界清晰，资源治理可控。

### 5) 认证体系兼容演进
- 难点：系统从纯 Session 向 JWT 模式演进时需兼容旧链路，避免全量改造带来的风险。  
- 方案：JWT 作为主路径、Session 作为兜底；登录时会话再生防固定攻击；退出时 Refresh Token 清理 + Access Token 黑名单失效。  
- 收益：在平滑兼容的前提下完成安全能力增强。

### 6) 前端上传体验与主线程负载
- 难点：大文件 MD5 计算会阻塞主线程，影响交互与上传流畅性。  
- 方案：通过 Web Worker 分块计算 MD5，进度实时回传；结合后端“已上传分片查询”实现断点续传。  
- 收益：上传期间页面交互更平滑，失败重试成本更低。

### 7) 可观测性落地难
- 难点：仅有日志无法快速定位性能瓶颈与故障来源。  
- 方案：引入业务指标与系统指标；采集前端 Web Vitals；容器化部署 Prometheus/Grafana 与告警规则。  
- 收益：故障定位路径更短，容量与性能调优更可量化。

## STAR 表达（面试可直接使用）

### STAR 1：上传体系重构
- S：网盘核心场景是大文件上传，网络抖动与高并发下失败率高。  
- T：在不破坏现有接口兼容性的前提下提升上传稳定性与可恢复性。  
- A：实现分片上传、断点续传、秒传、并发限流、空间校验与失败回滚清理；采用最后分片触发事务落库。  
- R：上传链路具备可恢复、可限流、可回滚能力，复杂场景稳定性显著提升。

### STAR 2：缓存稳定性治理
- S：文件/用户信息查询热点明显，数据库压力大。  
- T：降低回源压力并避免缓存异常导致的抖动。  
- A：落地多级缓存与空值缓存，结合布隆过滤器、分布式锁、随机 TTL 做防护。  
- R：热点读取性能和系统稳定性提升，数据库峰值压力下降。

### STAR 3：多租户能力建设
- S：系统需要支持多租户隔离与租户级资源治理。  
- T：建立从请求到数据层的租户一致性，并在关键路径执行配额控制。  
- A：实现租户拦截器、上下文管理、数据层租户工厂与配额服务。  
- R：租户隔离和资源边界清晰，可支撑后续租户化扩展。

### STAR 4：可观测性体系建设
- S：缺乏可视化指标，性能问题定位成本高。  
- T：建立覆盖前后端与基础设施的统一监控链路。  
- A：接入 Micrometer/Actuator、Web Vitals 入库、Prometheus/Grafana 与告警规则。  
- R：问题发现与定位效率提升，性能优化具备持续反馈闭环。

## 待补充（建议在投递前完善）
- 压测数据：建议补充并发量、P95/P99、上传成功率、缓存命中率等可量化指标。  
- 规模数据：建议补充用户规模、文件规模、峰值 QPS、日均上传量等业务量级指标。  
- 个人贡献占比：建议明确“我主导/我负责/我参与”边界，避免面试追问时口径不一致。  
