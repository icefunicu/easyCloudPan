import{D as me,a as te,r as n,e as v,f as u,h as f,j as t,w as o,k as he,n as p,t as N,F as K,l as B,m as k,v as W,_ as ye,E as ge,i,p as le,y as we,A as ke,q as be,s as Fe}from"./index-e609a1ae.js";const Ce={all:{accept:"*"},video:{accept:".mp4,.avi,.rmvb,.mkv,.mov"},music:{accept:".mp3,.wav,.wma,.mp2,.flac,.midi,.ra,.ape,.aac,.cda"},image:{accept:".jpeg,.jpg,.png,.gif,.bmp,.dds,.psd,.pdt,.webp,.xmp,.svg,.tiff"},doc:{accept:".pdf,.doc,.docx,.xls,.xlsx,.txt"},others:{accept:"*"}},Ne={__name:"ShareFile",setup($,{expose:A}){const{toClipboard:H}=me(),{proxy:d}=te(),E=n(document.location.origin+"/share/"),X={shareFile:"/share/shareFile"},b=n(0),c=n({}),x=n(),G={validType:[{required:!0,message:"请选择有效期"}],codeType:[{required:!0,message:"请选择提取码类型"}],code:[{required:!0,message:"请输入提取码"},{validator:d.Verify.shareCode,message:"请输入提取码"},{min:5,message:"提取码最少5位"}]},S=n(!0),s=n({show:!1,title:"分享",buttons:[{type:"primary",text:"确定",click:_=>{M()}}]}),F=n({}),M=async()=>{if(Object.keys(F.value).length>0){s.value.show=!1;return}x.value.validate(async _=>{if(!_)return;let r={};Object.assign(r,c.value);let h=await d.Request({url:X.shareFile,params:r});h&&(b.value=1,F.value=h.data,s.value.buttons[0].text="关闭",S.value=!1)})};A({show:_=>{b.value=0,s.value.show=!0,S.value=!0,F.value={},W(()=>{x.value.resetFields(),c.value=Object.assign({},_)})}});const T=async()=>{await H(`链接:${E.value}${F.value.shareId} 提取码:${F.value.code}`),d.Message.success("复制成功")};return(_,r)=>{const h=v("el-form-item"),y=v("el-radio"),R=v("el-radio-group"),O=v("el-input"),J=v("el-button"),U=v("el-form"),Q=v("Dialog");return u(),f("div",null,[t(Q,{show:s.value.show,title:s.value.title,buttons:s.value.buttons,width:"600px",showCancel:S.value,onClose:r[4]||(r[4]=m=>s.value.show=!1)},{default:o(()=>[t(U,{model:c.value,rules:G,ref_key:"formDataRef",ref:x,"label-width":"100px",onSubmit:r[3]||(r[3]=he(()=>{},["prevent"]))},{default:o(()=>[t(h,{label:"文件",prop:""},{default:o(()=>[p(N(c.value.fileName),1)]),_:1}),b.value==0?(u(),f(K,{key:0},[t(h,{label:"有效期",prop:"validType"},{default:o(()=>[t(R,{modelValue:c.value.validType,"onUpdate:modelValue":r[0]||(r[0]=m=>c.value.validType=m)},{default:o(()=>[t(y,{label:0},{default:o(()=>[p("1天")]),_:1}),t(y,{label:1},{default:o(()=>[p("7天")]),_:1}),t(y,{label:2},{default:o(()=>[p("30天")]),_:1}),t(y,{label:3},{default:o(()=>[p("永久有效")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(h,{label:"提取码",prop:"codeType"},{default:o(()=>[t(R,{modelValue:c.value.codeType,"onUpdate:modelValue":r[1]||(r[1]=m=>c.value.codeType=m)},{default:o(()=>[t(y,{label:0},{default:o(()=>[p("自定义")]),_:1}),t(y,{label:1},{default:o(()=>[p("系统生成")]),_:1})]),_:1},8,["modelValue"])]),_:1}),c.value.codeType==0?(u(),B(h,{key:0,prop:"code"},{default:o(()=>[t(O,{clearable:"",placeholder:"请输入5位提取码",modelValue:c.value.code,"onUpdate:modelValue":r[2]||(r[2]=m=>c.value.code=m),maxLength:"5",style:{width:"130px"}},null,8,["modelValue"])]),_:1})):k("",!0)],64)):(u(),f(K,{key:1},[t(h,{label:"分享链接"},{default:o(()=>[p(N(E.value)+N(F.value.shareId),1)]),_:1}),t(h,{label:"提取码"},{default:o(()=>[p(N(F.value.code),1)]),_:1}),t(h,null,{default:o(()=>[t(J,{type:"primary",onClick:T},{default:o(()=>[p("复制链接及提取码")]),_:1})]),_:1})],64))]),_:1},8,["model"])]),_:1},8,["show","title","buttons","showCancel"])])}}};const I=$=>(be("data-v-1da201ce"),$=$(),Fe(),$),Ie={class:"top"},xe={class:"top-op"},Se={class:"btn"},Te=I(()=>i("span",{class:"iconfont icon-upload"},null,-1)),Re=I(()=>i("span",{class:"iconfont icon-folder-add"},null,-1)),Ve=I(()=>i("span",{class:"iconfont icon-del"},null,-1)),De=I(()=>i("span",{class:"iconfont icon-move"},null,-1)),$e={class:"search-panel"},Ee={key:0,class:"file-list"},Me=["onMouseenter","onMouseleave"],qe=["title"],ze=["onClick"],Oe={key:0,class:"transfer-status"},Ue={key:1,class:"transfer-status transfer-fail"},Pe={key:3,class:"edit-panel"},Le=["onClick"],je=["onClick"],Be={class:"op"},Ke=["onClick"],Ae=["onClick"],He=["onClick"],Ge=["onClick"],Je={key:0},Qe={key:1,class:"no-data"},We={class:"no-data-inner"},Xe=I(()=>i("div",{class:"tips"},"当前目录为空, 上传你的第一个文件吧",-1)),Ye={class:"op-list"},Ze={class:"op-item"},el=I(()=>i("div",null,"上传文件",-1)),ll=I(()=>i("div",null,"新建目录",-1)),tl={__name:"Main",emits:["addFile"],setup($,{expose:A,emit:H}){const{proxy:d}=te(),E=e=>{H("addFile",{file:e.file,filePid:b.value.fileId})};A({reload:()=>{z.value=!1,_()}});const b=n({fileId:"0"}),c={loadDataList:"/file/loadDataList",rename:"/file/rename",newFoloder:"/file/newFoloder",getFolderInfo:"/file/getFolderInfo",delFile:"/file/delFile",changeFileFolder:"/file/changeFileFolder",createDownloadUrl:"/file/createDownloadUrl",download:"/api/file/download"},x=ge(()=>{const e=Ce[T.value];return e?e.accept:"*"}),G=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],S=()=>{z.value=!0,_()},s=n({}),F=n({extHeight:50,selectType:"checkbox"}),M=n(),z=n(!0),T=n(),_=async()=>{let e={pageNo:s.value.pageNo,pageSize:s.value.pageSize,fileNameFuzzy:M.value,filePid:b.value.fileId,category:T.value};e.category!=="all"&&delete e.filePid;let l=await d.Request({url:c.loadDataList,showLoading:z.value,params:e});l&&(s.value=l.data)},r=e=>{s.value.list.forEach(l=>{l.showOp=!1}),e.showOp=!0},h=e=>{e.showOp=!1},y=n(!1),R=n(),O=()=>{y.value||(s.value.list.forEach(e=>{e.showEdit=!1}),y.value=!0,s.value.list.unshift({showEdit:!0,fileType:0,fileId:"",filePid:0}),W(()=>{R.value.focus()}))},J=e=>{const l=s.value.list[e];l.fileId?l.showEdit=!1:s.value.list.splice(e,1),y.value=!1},U=async e=>{const{fileId:l,filePid:g,fileNameReal:V}=s.value.list[e];if(V==""||V.indexOf("/")!=-1){d.Message.warning("文件名不能为空且不能含有斜杠");return}let q=c.rename;l==""&&(q=c.newFoloder);let j=await d.Request({url:q,params:{fileId:l,filePid:g,fileName:V}});j&&(s.value.list[e]=j.data,y.value=!1)},Q=e=>{s.value.list[0].fileId==""&&(s.value.list.splice(0,1),e=e-1),s.value.list.forEach(g=>{g.showEdit=!1});let l=s.value.list[e];l.showEdit=!0,l.folderType==0?(l.fileNameReal=l.fileName.substring(0,l.fileName.indexOf(".")),l.fileSuffix=l.fileName.substring(l.fileName.indexOf("."))):(l.fileNameReal=l.fileName,l.fileSuffix=""),y.value=!0,W(()=>{R.value.focus()})},m=n([]),ae=e=>{m.value=[],e.forEach(l=>{m.value.push(l.fileId)})},oe=e=>{d.Confirm(`你确定要删除【${e.fileName}】吗? 删除的文件可在10天内通过回收站还原`,async()=>{await d.Request({url:c.delFile,params:{fileIds:e.fileId}})&&_()})},se=()=>{m.value.length!=0&&d.Confirm("你确定要删除这些文件吗? 删除的文件可在10天内通过回收站还原",async()=>{await d.Request({url:c.delFile,params:{fileIds:m.value.join(",")}})&&_()})},P=n(),L=n({}),ie=e=>{L.value=e,P.value.showFolderDialog(b.value.fileId)},ne=()=>{L.value={},P.value.showFolderDialog(b.value.fileId)},ce=async e=>{if(b.value.fileId==e){d.Message.warning("文件正在当前目录, 无需移动");return}let l=[];L.value.fileId?l.push(L.value.fileId):l=l.concat(m.value),await d.Request({url:c.changeFileFolder,params:{fileIds:l.join(","),filePid:e}})&&(P.value.close(),_())},Y=n(),Z=n(),ue=e=>{if(e.folderType==1){Y.value.openFolder(e);return}if(e.status!=2){d.Message.warning("文件未完成转码, 无法预览");return}Z.value.showPreview(e,0)},de=e=>{const{categoryId:l,curFolder:g}=e;b.value=g,T.value=l,_()},re=async e=>{let l=await d.Request({url:c.createDownloadUrl+"/"+e.fileId});l&&(window.location.href=c.download+"/"+l.data)},ee=n(),fe=e=>{ee.value.show(e)};return(e,l)=>{const g=v("el-button"),V=v("el-upload"),q=v("el-input"),j=v("Navigation"),D=v("Icon"),pe=v("Table"),ve=v("FolderSelect"),_e=v("Preview");return u(),f("div",null,[i("div",Ie,[i("div",xe,[i("div",Se,[t(V,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":E,accept:x.value},{default:o(()=>[t(g,{type:"primary"},{default:o(()=>[Te,p(" 上传 ")]),_:1})]),_:1},8,["accept"])]),t(g,{type:"success",onClick:O},{default:o(()=>[Re,p(" 新建文件夹 ")]),_:1}),t(g,{type:"danger",disabled:m.value.length==0,onClick:se},{default:o(()=>[Ve,p(" 批量删除 ")]),_:1},8,["disabled"]),t(g,{type:"warning",disabled:m.value.length==0,onClick:ne},{default:o(()=>[De,p(" 批量移动 ")]),_:1},8,["disabled"]),i("div",$e,[t(q,{clearable:"",placeholder:"请输入文件名搜索",modelValue:M.value,"onUpdate:modelValue":l[0]||(l[0]=C=>M.value=C),onKeyup:le(S,["enter"])},{suffix:o(()=>[i("i",{class:"iconfont icon-search",onClick:S})]),_:1},8,["modelValue","onKeyup"])]),i("div",{class:"iconfont icon-refresh",onClick:_})]),t(j,{ref_key:"navigationRef",ref:Y,onNavChange:de},null,512)]),s.value.list&&s.value.list.length>0?(u(),f("div",Ee,[t(pe,{ref:"dataTableRef",columns:G,dataSource:s.value,fetch:_,initFetch:!1,options:F.value,onRowSelected:ae},{fileName:o(({index:C,row:a})=>[i("div",{class:"file-item",onMouseenter:w=>r(a),onMouseleave:w=>h(a)},[(a.fileType==3||a.fileType==1)&&a.status==2?(u(),B(D,{key:0,cover:a.fileCover,width:32},null,8,["cover"])):(u(),f(K,{key:1},[a.folderType==0?(u(),B(D,{key:0,fileType:a.fileType},null,8,["fileType"])):k("",!0),a.folderType==1?(u(),B(D,{key:1,fileType:0})):k("",!0)],64)),a.showEdit?k("",!0):(u(),f("span",{key:2,class:"file-name",title:a.fileName},[i("span",{onClick:w=>ue(a)},N(a.fileName),9,ze),a.status==0?(u(),f("span",Oe,"转码中")):k("",!0),a.status==1?(u(),f("span",Ue,"转码失败")):k("",!0)],8,qe)),a.showEdit?(u(),f("div",Pe,[t(q,{modelValue:a.fileNameReal,"onUpdate:modelValue":w=>a.fileNameReal=w,modelModifiers:{trim:!0},ref_key:"editNameRef",ref:R,maxLength:190,onKeyup:le(w=>U(C),["enter"])},{suffix:o(()=>[p(N(a.fileSuffix),1)]),_:2},1032,["modelValue","onUpdate:modelValue","onKeyup"]),i("span",{class:we(["iconfont icon-right1",a.fileNameReal?"":"not-allow"]),onClick:w=>U(C)},null,10,Le),i("span",{class:"iconfont icon-error",onClick:w=>J(C)},null,8,je)])):k("",!0),i("span",Be,[a.showOp&&a.fileId&&a.status==2?(u(),f(K,{key:0},[i("span",{class:"iconfont icon-share1",onClick:w=>fe(a)},"分享",8,Ke),a.folderType==0?(u(),f("span",{key:0,class:"iconfont icon-download",onClick:w=>re(a)},"下载",8,Ae)):k("",!0),i("span",{class:"iconfont icon-del",onClick:w=>oe(a)},"删除",8,He),i("span",{class:"iconfont icon-edit",onClick:w=>Q(C)},"重命名",8,Ge),i("span",{class:"iconfont icon-move",onClick:ie},"移动")],64)):k("",!0)])],40,Me)]),fileSize:o(({index:C,row:a})=>[a.fileSize?(u(),f("span",Je,N(ke(d).Utils.size2Str(a.fileSize)),1)):k("",!0)]),_:1},8,["dataSource","options"])])):(u(),f("div",Qe,[i("div",We,[t(D,{iconName:"no_data",width:120,fit:"fill"}),Xe,i("div",Ye,[t(V,{"show-file-list":!1,"with-credentials":!0,multiple:!0,"http-request":E,accept:x.value},{default:o(()=>[i("div",Ze,[t(D,{iconName:"file",width:60}),el])]),_:1},8,["accept"]),T.value=="all"?(u(),f("div",{key:0,class:"op-item",onClick:O},[t(D,{iconName:"folder",width:60}),ll])):k("",!0)])])])),t(ve,{ref_key:"folderSelectRef",ref:P,onFolderSelect:ce},null,512),t(_e,{ref_key:"previewRef",ref:Z},null,512),t(Ne,{ref_key:"shareRef",ref:ee},null,512)])}}},ol=ye(tl,[["__scopeId","data-v-1da201ce"]]);export{ol as default};
