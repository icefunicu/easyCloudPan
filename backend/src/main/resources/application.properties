# 应用服务 WEB 访问端口
server.port=${SERVER_PORT:7090}
server.servlet.context-path=/api
#session过期时间 60M 一个小时
server.servlet.session.timeout=PT60M
#处理favicon
spring.mvc.favicon.enable=false
spring.servlet.multipart.max-file-size=15MB
spring.servlet.multipart.max-request-size=15MB
#错误页处理
spring.web.resources.add-mappings=false

# 数据库配置
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://127.0.0.1:5432/easypan}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:postgres}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP 连接池优化配置
spring.datasource.hikari.pool-name=EasyPanHikariCP
spring.datasource.hikari.minimum-idle=50
spring.datasource.hikari.maximum-pool-size=200
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=5000
spring.datasource.hikari.auto-commit=true
spring.datasource.hikari.connection-test-query=SELECT 1
spring.datasource.hikari.validation-timeout=5000
spring.datasource.hikari.leak-detection-threshold=60000
# 性能优化
spring.datasource.hikari.data-source-properties.cachePrepStmts=true
spring.datasource.hikari.data-source-properties.prepStmtCacheSize=250
spring.datasource.hikari.data-source-properties.prepStmtCacheSqlLimit=2048
spring.datasource.hikari.data-source-properties.useServerPrepStmts=true

#发送邮件配置相关
spring.mail.host=${SPRING_MAIL_HOST:smtp.qq.com}
spring.mail.port=${SPRING_MAIL_PORT:465}
spring.mail.username=${SPRING_MAIL_USERNAME:}
spring.mail.password=${SPRING_MAIL_PASSWORD:}
spring.mail.default-encoding=UTF-8
spring.mail.properties.mail.smtp.socketFactory.class=javax.net.ssl.SSLSocketFactory
spring.mail.properties.mail.debug=${SPRING_MAIL_DEBUG:false}

#Spring Redis配置
spring.data.redis.database=0
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:}
spring.data.redis.timeout=3000

#Spring Redis配置
spring.data.redis.database=0
spring.data.redis.host=${SPRING_DATA_REDIS_HOST:localhost}
spring.data.redis.port=${SPRING_DATA_REDIS_PORT:6379}
spring.data.redis.password=${SPRING_DATA_REDIS_PASSWORD:}
spring.data.redis.timeout=3000
# Redis 连接池优化 (Lettuce)
spring.data.redis.lettuce.pool.max-active=200
spring.data.redis.lettuce.pool.max-idle=50
spring.data.redis.lettuce.pool.min-idle=20
spring.data.redis.lettuce.pool.max-wait=3000ms

#项目目录
project.folder=${PROJECT_FOLDER:${user.dir}/data/easycloudpan/}

# MinIO配置
minio.endpoint=${MINIO_ENDPOINT:http://localhost:9000}
minio.accessKey=${MINIO_ACCESS_KEY:}
minio.secretKey=${MINIO_SECRET_KEY:}
minio.bucketName=${MINIO_BUCKET_NAME:easypan}
minio.connection-timeout=10000
minio.socket-timeout=30000

# 开启虚拟线程 (Java 21)
spring.threads.virtual.enabled=true
spring.task.execution.pool.core-size=50
spring.task.execution.pool.max-size=200
spring.task.execution.pool.queue-capacity=1000
spring.task.execution.pool.keep-alive=60s
virtual-threads.enabled=true
virtual-threads.name-prefix=vt-async-

#日志级别配置
log.root.level=${LOG_ROOT_LEVEL:info}
log.file.dir=${LOG_FILE_DIR:${project.folder}logs}
log.archive.dir=${LOG_ARCHIVE_DIR:${log.file.dir}/archive}
log.max.file.size=${LOG_MAX_FILE_SIZE:50MB}
log.max.history=${LOG_MAX_HISTORY:30}
log.total.size.cap=${LOG_TOTAL_SIZE_CAP:5GB}
log.clean.history.on.start=${LOG_CLEAN_HISTORY_ON_START:false}
#超级管理员id
admin.emails=${ADMIN_EMAILS:admin@example.com}
#是否是开发环境
dev=${DEV_MODE:false}

##QQ登陆相关##
qq.app.id=${QQ_APP_ID:}
qq.app.key=${QQ_APP_KEY:}
qq.url.authorization=https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=%s&redirect_uri=%s&state=%s
qq.url.access.token=https://graph.qq.com/oauth2.0/token?grant_type=authorization_code&client_id=%s&client_secret=%s&code=%s&redirect_uri=%s
qq.url.openid=https://graph.qq.com/oauth2.0/me?access_token=%S
qq.url.user.info=https://graph.qq.com/user/get_user_info?access_token=%s&oauth_consumer_key=%s&openid=%s
qq.url.redirect=${QQ_URL_REDIRECT:http://localhost:8080/qqlogincallback}

# OAuth2 Multi-Platform Login Configuration
oauth.github.client-id=${OAUTH_GITHUB_CLIENT_ID:}
oauth.github.client-secret=${OAUTH_GITHUB_CLIENT_SECRET:}
oauth.github.redirect-uri=${OAUTH_GITHUB_REDIRECT_URI:http://localhost:5173/oauth/callback/github}

oauth.gitee.client-id=${OAUTH_GITEE_CLIENT_ID:}
oauth.gitee.client-secret=${OAUTH_GITEE_CLIENT_SECRET:}
oauth.gitee.redirect-uri=${OAUTH_GITEE_REDIRECT_URI:http://localhost:5173/oauth/callback/gitee}

oauth.google.client-id=${OAUTH_GOOGLE_CLIENT_ID:}
oauth.google.client-secret=${OAUTH_GOOGLE_CLIENT_SECRET:}
oauth.google.redirect-uri=${OAUTH_GOOGLE_REDIRECT_URI:http://localhost:5173/oauth/callback/google}

oauth.microsoft.client-id=${OAUTH_MICROSOFT_CLIENT_ID:}
oauth.microsoft.client-secret=${OAUTH_MICROSOFT_CLIENT_SECRET:}
oauth.microsoft.redirect-uri=${OAUTH_MICROSOFT_REDIRECT_URI:http://localhost:5173/oauth/callback/microsoft}

# Flyway Database Migration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.locations=classpath:db/migration
spring.flyway.validate-on-migrate=false
spring.flyway.out-of-order=false

# Actuator Monitoring
management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.endpoint.health.show-details=always
management.health.ldap.enabled=false
management.metrics.tags.application=${spring.application.name}
management.prometheus.metrics.export.enabled=true
management.metrics.enable.jvm=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.enable.http=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# Jackson configuration
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss
spring.jackson.time-zone=GMT+8

# MyBatis-Flex Configuration
mybatis-flex.type-aliases-package=com.easypan.entity.po
mybatis-flex.configuration.map-underscore-to-camel-case=true
mybatis-flex.configuration.log-impl=org.apache.ibatis.logging.nologging.NoLoggingImpl
mybatis-flex.enable-sql-annotation=false

# JWT Configuration
jwt.secret=${JWT_SECRET:}
jwt.expiration=604800000
jwt.refresh-expiration=2592000000
security.signature.secret=${SIGNATURE_SECRET:easypan-default-secret}

# Jasypt Encryption Configuration
jasypt.encryptor.password=${JASYPT_ENCRYPTOR_PASSWORD:}
jasypt.encryptor.algorithm=PBEWITHHMACSHA512ANDAES_256
jasypt.encryptor.iv-generator-classname=org.jasypt.iv.RandomIvGenerator
jasypt.encryptor.provider-name=SunJCE
jasypt.encryptor.output-type=base64
jasypt.encryptor.string-output-type=base64

# Cache Configuration (Caffeine)
spring.cache.type=caffeine
spring.cache.caffeine.spec=maximumSize=10000,expireAfterWrite=600s

