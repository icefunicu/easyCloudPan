import{_ as K,a as j,r as c,e as u,f as l,h as n,i as a,j as _,w as m,p as H,m as o,n as G,l as F,F as w,t as T,A as J,q as Q,s as W}from"./index-e609a1ae.js";const X=v=>(Q("data-v-468c98b9"),v=v(),W(),v),Y={class:"top"},Z={class:"top-op"},ee={class:"search-panel"},te=X(()=>a("span",{class:"iconfont icon-del"},null,-1)),se={key:0,class:"file-list"},le=["onMouseenter","onMouseleave"],ae=["title"],ne=["onClick"],oe={key:0,class:"transfer-status"},ie={key:1,class:"transfer-status transfer-fail"},ce={class:"op"},de=["onClick"],re=["onClick"],ue={key:0},pe={__name:"FileList",setup(v){const{proxy:i}=j(),p={loadDataList:"/admin/loadFileList",delFile:"/admin/delFile",createDownloadUrl:"/admin/createDownloadUrl",download:"/api/admin/download"},x=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"发布人",prop:"nickName",width:250},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],S=()=>{k.value=!0,r()},d=c({}),z=c({extHeight:50,selectType:"checkbox"}),f=c([]),L=t=>{f.value=[],t.forEach(s=>{f.value.push(s.userId+"_"+s.fileId)})},y=c(),k=c(!0),r=async()=>{let t={pageNo:d.value.pageNo,pageSize:d.value.pageSize,fileNameFuzzy:y.value,filePid:N.value.fileId},s=await i.Request({url:p.loadDataList,showLoading:k.value,params:t});s&&(d.value=s.data)},R=t=>{d.value.list.forEach(s=>{s.showOp=!1}),t.showOp=!0},D=t=>{t.showOp=!1},b=c(),C=c(),U=t=>{if(t.folderType==1){b.value.openFolder(t);return}if(t.status!=2){i.Message.warning("文件未完成转码, 无法预览");return}C.value.showPreview(t,1)},N=c({fileId:"0"}),O=t=>{const{curFolder:s}=t;N.value=s,k.value=!0,r()},V=t=>{i.Confirm(`你确定要删除【${t.fileName}】吗? 删除后不可还原`,async()=>{await i.Request({url:p.delFile,params:{fileIdAndUserIds:t.userId+"_"+t.fileId}})&&r()})},$=()=>{f.value.length!=0&&i.Confirm("你确定要删除这些文件吗? 删除后不可还原",async()=>{await i.Request({url:p.delFile,params:{fileIdAndUserIds:f.value.join(",")}})&&r()})},q=async t=>{let s=await i.Request({url:p.createDownloadUrl+"/"+t.userId+"/"+t.fileId});s&&(window.location.href=p.download+"/"+s.data)};return(t,s)=>{const B=u("el-input"),M=u("el-button"),E=u("Navigation"),g=u("Icon"),P=u("Table"),A=u("Preview");return l(),n("div",null,[a("div",Y,[a("div",Z,[a("div",ee,[_(B,{clearable:"",placeholder:"请输入文件名搜索",modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=I=>y.value=I),onKeyup:H(S,["enter"])},{suffix:m(()=>[a("i",{class:"iconfont icon-search",onClick:S})]),_:1},8,["modelValue","onKeyup"])]),a("div",{class:"iconfont icon-refresh",onClick:r}),_(M,{type:"danger",style:{"margin-left":"10px"},disabled:f.value.length==0,onClick:$},{default:m(()=>[te,G(" 批量删除 ")]),_:1},8,["disabled"])]),_(E,{ref_key:"navigationRef",ref:b,onNavChange:O},null,512)]),d.value.list&&d.value.list.length>0?(l(),n("div",se,[_(P,{ref:"dataTableRef",columns:x,dataSource:d.value,fetch:r,initFetch:!1,options:z.value,onRowSelected:L},{fileName:m(({index:I,row:e})=>[a("div",{class:"file-item",onMouseenter:h=>R(e),onMouseleave:h=>D(e)},[(e.fileType==3||e.fileType==1)&&e.status==2?(l(),F(g,{key:0,cover:e.fileCover,width:32},null,8,["cover"])):(l(),n(w,{key:1},[e.folderType==0?(l(),F(g,{key:0,fileType:e.fileType},null,8,["fileType"])):o("",!0),e.folderType==1?(l(),F(g,{key:1,fileType:0})):o("",!0)],64)),e.showEdit?o("",!0):(l(),n("span",{key:2,class:"file-name",title:e.fileName},[a("span",{onClick:h=>U(e)},T(e.fileName),9,ne),e.status==0?(l(),n("span",oe,"转码中")):o("",!0),e.status==1?(l(),n("span",ie,"转码失败")):o("",!0)],8,ae)),a("span",ce,[e.showOp&&e.fileId&&e.status==2?(l(),n(w,{key:0},[e.folderType==0?(l(),n("span",{key:0,class:"iconfont icon-download",onClick:h=>q(e)},"下载",8,de)):o("",!0),a("span",{class:"iconfont icon-del",onClick:h=>V(e)},"删除",8,re)],64)):o("",!0)])],40,le)]),fileSize:m(({index:I,row:e})=>[e.fileSize?(l(),n("span",ue,T(J(i).Utils.size2Str(e.fileSize)),1)):o("",!0)]),_:1},8,["dataSource","options"])])):o("",!0),_(A,{ref_key:"previewRef",ref:C},null,512)])}}},_e=K(pe,[["__scopeId","data-v-468c98b9"]]);export{_e as default};
